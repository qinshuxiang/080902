# 计算机网络

## 计算机网络概述

### 计算机网络基础概念

**计算机网络技术**：是**通信技术与计算机技术相**结合的产物。

**计算机网络**：互连、自治的多个计算机系统，通过各种**通信设备和线路**连接起来，在**网络协议和软件的支持**下进行数据通信，实现**信息交换和资源共享**的系统。

计算机网络由若干**结点**和连接这些结点的**链路**组成。结点可以是计算机、集线器、交换机、路由器等。链路可以是有线链路、无线链路。

> 我们每天都会使用计算机网络，使用不同类型的设备去连接计算机网络，比如手机、笔记本电脑或者台式机，现在还有智能手表，智能电视，这些都可以连接计算机网络。
>
> 不同的设备，连接计算机网络的方式也各不相同，笔记本电脑可以通过WIFI连接路由器从而接入计算机网络，台式机可以通过网线连接路由器从而接入网络，另外我们平时在外面使用手机，都是通过5G通信的技术去连接5G基站从而接入计算机网络。
>
> 在这些电脑和手机当中我们会安装一些方便易用的软件，比如说百度网盘或者微信，我们可以用百度网盘去共享一些资源等等。

**互连网**：由路由器把两个或者多个计算机网络连接起来的网络称为互联网，路由器也可以和路由器互连，**可以使用任意的协议通信**。

**互联网**：覆盖全世界范围的互连网（因特网）。**由ISP（互联网服务提供商：移动、电信、联通等）和国际机构提供**。**互联网必须使用TCP/IP协议族通信。**

Internet 不属于某个国家或组织。



### 计算机网络的组成

计算机网络的组成可以根据不同的标准进行分类，主要包括：

#### 1. 按组成部分

- **硬件**
  - **主机**，即端系统，包括电脑、手机、物联网设备等。
  
  - **通信设备**，典型的通信设备就是路由器。

  - **通信链路**，连接网络的线路，如：网线、光纤、同轴电缆。
  
- **软件**
- **协议**：用于规定计算机网络中的通信规则。**协议由硬件、软件共同实现**，如：网络适配器 + 软件，来实现网络通信协议。

#### 2. 按工作方式

- **边缘部分**：由连接到互联网上的主机及其软件组成，直接为用户服务（数据通信、资源共享）。
- **核心部分**：为边缘部分提供服务（**连通性、交换服务【为数据的传输选择合适的路径】**），由网络与连接这些网络的路由器组成。

#### 3. 按逻辑功能

- **资源子网**：向用户提供了硬件、软件和信息资源的共享，主要由连接到互联网上的主机组成。
- **通信子网**：在计算机网络中，负责数据传输和交换。所有的通信设备和通信介质都属于通信子网的范畴，网络适配器这种硬件以及一些底层的网络协议也是为了实现计算机之间的这种信息传输。



### 计算机网络的功能

1. **数据通信**
2. **资源共享**
3. 分布式处理：将复杂任务分配给多个计算机处理，将最后的结果进行汇总处理
4. 提高可靠性：各台计算机互为替代机，进行数据冗余备份
5. 负载均衡：共同分担大量的网络请求，较小压力的服务器分担部分压力较大的服务器的部分功能



### 计算机网络的分类

计算机网络可以根据不同的标准进行分类，主要包括：

#### 1. 按覆盖范围

1. 个域网（PAN）：通常是一些无线技术将个人设备连接。
2. **局域网（LAN）**：覆盖小范围，如办公室或校园或者单位、部门。**常用以太网技术**。
3. 城域网（MAN）：介于局域网和广域网之间，覆盖城市区域。
4. **广域网（WAN）**：覆盖大范围，如城市、国家或全球。**局域网通过路由器连接广域网**。

| **特性**         | **局域网（LAN）**                    | **广域网（WAN）**                                          |
| ---------------- | ------------------------------------ | ---------------------------------------------------------- |
| **传输速度**     | 高速（一般为100Mbps ~ 10Gbps及以上） | 较慢（一般为几十Mbps到Gbps）                               |
| **延迟**         | 低延迟，适合高实时性需求             | 高延迟，尤其在跨国通信中更明显                             |
| **传输介质**     | 双绞线、电缆、光纤、Wi-Fi等          | 光纤、电缆、卫星通信、蜂窝网络等                           |
| **网络结构**     | 常为**星形、总线、环形拓扑**结构     | 采用路由器和交换机构建的复杂网络。通常使用**网状拓扑结构** |
| **典型协议**     | **以太网（Ethernet）、Wi-Fi**        | **MPLS、PPP、BGP、IP**                                     |
| **安全性**       | 较高，通常只限内部访问               | 安全性较低，需要VPN或防火墙保护                            |
| **数据交换技术** | **共享广播**                         | **存储转发**                                               |

#### 2. 按拓扑结构

**总线拓扑**：所有设备共享一条主干线路，通过分支连接到主干上。布线简单，成本低。**总线故障会导致整个网络失效**。当设备增加时，容易出现通信冲突，影响性能。负载能力有限。实时性差。**广播式传输，存在总线争用问题**。

**环形拓扑**：每个设备与相邻的两个设备连接，形成一个闭合的环路。**数据以单一方向传输，减少冲突**。任意一个节点故障会导致整个网络中断。网络扩展不灵活。**广播式传输**，使用**令牌解决总线争用问题，只有持有令牌者可以发送消息**。

**星形拓扑**：所有设备通过独立的线路连接到一个中央节点（如交换机或路由器）。单个设备故障不会影响整个网络。**依赖中央节点**，若其故障则网络瘫痪。布线成本高，需要大量电缆。**点对点传输**。

**网状拓扑**：每个设备与网络中的多个设备直接相连。即使某条连接失效，也不会影响通信。布线复杂且成本高。**点对点传输**。**常见于广域网**。

> **树形拓扑**：由多个星形拓扑通过总线连接组成，形成类似树的层次结构。易于扩展，适合层级结构的网络（如学校、企业网络）。高层节点的故障可能影响下层所有节点。网络复杂性增加时维护难度加大。

#### 3. 按传输媒介

1. **有线网络**

2. **无线网络**

#### 4. 按功能

1. 公用网
2. 专用网：由一个组织或机构独立构建和维护，仅供内部使用的网络。

#### 5. 按传输技术分类

| 网络类型   | 定义                                                         |
| ---------- | ------------------------------------------------------------ |
| 广播式网络 | 所有节点共享同一条通信信道，数据包发送后会被所有设备接收，**但只有目标节点处理** |
| 点对点网络 | 每一对通信设备之间通过独立的通信链路进行数据传输，不共享传输介质 |



### 计算机网络的性能指标

信道：表示向某一方向传送信息的通道。通信线路：一条通信线路在逻辑上往往对应一条发送信道和一条接收信道。

`K M G T` 在计算机网络中一般转换为`10^3`倍率，在计算机组成原理与操作系统中是`2^10`倍率

#### 1. 速率、带宽、吞吐量

| 性能指标 | 描述 |
| -------- | ---- |
| **速率 ** | 也称为数据传输速率，表示每秒钟传输的比特数，单位为 **bps（bits per second）**，即bit/s。速率通常用于衡量链路的传输能力，**1B = 8b** |
| **带宽** | 表示通信链路所能提供的**最高数据传输能力**，单位同样为 **bps**。宽带决定了链路理论上的最大传输速率。**上行带宽是指的上传速率，下行带宽指的下载速率** |
| **吞吐量 ** | 实际传输的数据量，通常受限于网络拥塞、协议开销和硬件性能，单位为 **bps**。吞吐量反映了**系统的实际性能** |

**节点间通信实际能达到的最高速率，由带宽、节点性能共同限制**。

> 电磁波的波长表示电磁波一个周期的长度，频率表示1s可以震动多少次。宽带表示信道允许通过的信号频带范围，单位Hz。

#### 2. 时延、时延带宽积、往返时延

| 性能指标          | 描述                                                         |
| ----------------- | ------------------------------------------------------------ |
| **时延 **         | 指数据从发送端到达接收端所需的时间，单位为 **毫秒（ms）**，包括**发送时延、传播时延、处理时延、排队时延** |
| **时延带宽积**    | 表示网络中同时存在的数据量，为 **带宽 × 时延**，用于衡量链路的"填充"程度 |
| **往返时延 RTT ** | 数据从**发送端发送完**到接收端再**返回发送端**所需的时间，单位为 **ms**。**RTT 是 TCP 等协议中重要的性能指标** |

> **发送时延**：又名传输时延，节点将数据推向信道所花的时间。
>
> **传播时延**：电磁波在信道中传播一定的距离所花的时间。
>
> **处理时延**：被路由器处理所花的时间 (如：分析首部、查找存储转发表)。
>
> **排队时延**：数据排队进入、排队发出路由器所花的时间。

#### 3. 信道利用率

表示信道中实际用于传输数据的时间与总可用时间的比值。信道利用率越高，说明链路资源的使用越有效。。`信道利用率 = 有数据通过的时间 / （有数据通过的时间 + 没数据通过的时间）`。**信道利用率太低，浪费资源**。**过高的信道利用率可能导致网络拥塞和延迟增大。**



### 标准化工作及相关组织

#### 1. 标准的分类的分类

- 法定标准：由权威机构制定的正式合法的标准，如OSI。
- **事实标准**：某些公司产品在竞争中占据主流，其产品的协议与技术就成为了标准，如**TCP/IP**。

#### 2. 相关组织

- **国际标准化组织ISO**：OSI、HDLC。
- 国际电信联盟ITU：制定通信规则。
- **国际电气电子工程师协会IEEE。**
- 因特网工程任务组IETF：因特网标准制定。



### 数据交换技术

#### 1. 电路交换

电路交换通过物理线路的连接，动态的分配传输线路资源。**更适合低频次、大量数据的传输**。电话网络是典型的电路交换网络。

电路交换首先需要建立连接（尝试占用通信资源，连接物理线路），然后通信的过程中一直占用通信资源，通信结束释放通信资源。电路交换不使用存储转发，所以时间开销只包含传播时延、发送时延和一个电路建立时间。

- 优点

  - **专用通信路径**：在通信期间**保持独占的物理路径**，传输过程稳定、快速。没有其他数据干扰，确保数**据按顺序传输**。
- 缺点

  - **建立和释放路径开销大**：每次通信都需要进行**路径建立和释放，这会带来额外的延迟**。

  - **线路独占导致资源浪费**：双方在通信的过程中，占用的路径无法被别人使用，导致别人发送的信息无法送达。

  - **缺乏灵活性**：线路分配不灵活，**无法适应动态流量需求**，应对中间传输过程的故障能力较差。

  - **差错控制困难**：通信过程中**没有中间节点可以进行差错处理**。

> 我国通信公司在3G时代采用的三种主要标准包括：
>
> 1. **TD-SCDMA**（Time Division Synchronous Code Division Multiple Access）：由中国自主研发，是我国特有的3G标准。它主要由**中国移动**采用，具有较强的自主知识产权。TD-SCDMA使用**时分双工**（TDD）技术，相比其他3G标准更适合不对称的上下行流量需求。
> 2. **WCDMA**（Wideband Code Division Multiple Access）：这是由3GPP制定的国际标准，采用**频分双工**（FDD）技术。WCDMA被**中国联通**采用，是全球范围内应用最广泛的3G标准之一。WCDMA的特点是具有较高的数据传输速度和广泛的国际兼容性。
> 3. **CDMA2000**：由3GPP2制定，基于高通的CDMA技术演变而来，采用FDD技术。**中国电信**使用CDMA2000标准，它的优势在于高频谱效率和稳定的语音服务质量，主要用于语音和数据业务的融合。

#### 2. 报文交换

报文交换采用**存储-转发技术**，每个报文在经过节点时会被**暂时存储**，直到找到合适的路径后再转发。电报网络是典型的报文交换网络。

- 优点

  - **线路灵活分配**：路径**根据网络负载情况动态调整**。

  - **无需建立连接**：发送方不需要预先建立通信连接，**无需独占物理线路**。

  - **支持校验技术**：可以在中间节点进行差错控制。
- 缺点

  - **传输延迟较大**：报文必须在节点进行存储和转发，容易产生延迟，缓存开销大，**长报文容易出错导致重传**。
  - **报文不定长**：不同长度的报文不利于统一存储和管理不利于存储、转发，需要中间节点内存管理造成困难。

#### 3. 分组交换

分组交换将数据拆分为多个小的分组并添加首部控制信息，每个分组独立传输，并在目的地重新组装成完整的数据。现代的计算机网络使用的正是这种技术。

- 优点

  - **线路灵活分配**：路径根据网络负载情况动态调整。
  - **无需建立连接**：发送方不需要预先建立通信连接，无需独占物理线路。
  - **支持校验技术**：可以在中间节点进行差错控制。
  - **分组定长，方便存储与转发**：统一的分组长度有助于高效管理和调度，转发时间小，缓存小，错误重传代价低。
- 缺点

  - **控制信息开销大**：每个分组都需要附加控制信息（如源地址、目的地址、分组号），占用了部分带宽。

  - **可能存在时延**：传输过程中，存在转发时延。

  - **数据丢失与失序问题**：由于不同分组可能走不同路径，接收端需要处理失序和丢失的数据包，增加处理的复杂度。

#### 4. 虚电路交换

在虚电路交换中，数据传输的过程类似于电路交换，但是并不像传统电路交换那样在整个通信会话期间占用固定的资源。相反，虚电路交换通过在网络中建立一条逻辑上的路径（虚电路），在这条路径上进行数据传输。通信过程中分组**按序**、按已建立好的既定线路发送，**通信双方不独占线路**。这个虚电路在通信的开始时建立，而在通信结束后则释放。

虚电路交换的特点包括：

1. **建立和拆除过程**：通信开始时需要建立虚电路，这一过程需要一定的时间和网络资源；通信结束后，虚电路被拆除，释放资源。
2. **通信效率**：与电路交换相比，虚电路交换可以更高效地利用网络资源，因为资源不是在整个通信会话期间一直保持占用状态，而是按需分配。
3. **适用性**：虚电路交换适合那些**需要保证一定通信质量和传输顺序的应用，但又不需要像电路交换那样长时间占用资源的场景**，如音视频通话、实时数据传输等。

在实现上，虚电路交换可以通过在网络层和传输层之间建立逻辑上的路径来实现，每个路径可以通过路由器或交换机进行管理和维护。

#### 5. 数据报服务 Vs  虚电路服务

|                    | 数据报服务                     | 虚电路服务                                         |
| ------------------ | ------------------------------ | -------------------------------------------------- |
| 建立连接           | 不用                           | 必须                                               |
| 目的地址           | 每个分组都要有目的地址         | 仅在建立连接时使用，之后每个分组使用较短的虚电路号 |
| 路由选择           | 每个分组单独进行路由选择与转发 | 属于同一条虚电路的分组按照同一个路由转发           |
| 分组顺序           | 不保证有序到达                 | 保证有序到达                                       |
| 可靠性             | 不保证，可靠性依靠用户主机保证 | 保证                                               |
| 网络故障适应性     | 强                             | 弱                                                 |
| 差错控制和流量控制 | 用户主机完成                   | 可由网络完成也可以由用户主机完成                   |



## 计算机网络的体系结构

### 协议、服务

**实体**：第$n$层中的活动元素称为$n$​层实体。同一层的实体就是对等实体。

**协议**：为进行网络中的对等实体数据交换而建立的规则、标准或约定。是水平方向的。

- **语法**：数据与控制信息的格式。
- **语义**：需要发出何种控制信息、完成何种动作及做出何种应答。例如，协议中需要明确规定发送方完数据后，接收方是否需要应答。
- **同步**：**执行各种操做的条件、时序关系**等。例如，发送方发完数据后，接收方需要立即应答。如果发送方在10秒内未收到“传输成功”应答，则发送方会再次发送数据。

**服务**：下层为相邻上层提供的功能调用，是垂直方向的。

网络的体系结构是**计算机网络的各层及其协议的集合**，就是这个计算机网络及其构件所应完成的**功能的精确定义(不涉及实现)**。实现是遵循这种体系结构的前提下，用何种硬件或软件完成这些功能的问题。

> 体系结构是抽象的，而实现则是具体的。协议规定的是水平的，服务是垂直的关系。
>
> 协议数据单元(**PDU**)：对等层次之间传送的数据单位。
>
> - 服务数据单元(**SDU**)：为完成上一层实体所要求的功能而传送的数据。
> - 协议控制信息(**PCI**)：控制协议操作的信息。



### OSI模型

OSI全称**开放式系统互联参考模型**。上面四层是端到端的通信，而下面三层是点到点的通信。

| 层次       | 功能                                                         | 单位   | 协议                        |
| ---------- | ------------------------------------------------------------ | ------ | --------------------------- |
| 应用层     | 用户与网络的界面；直接为用户的应用进程提供服务               |        | **HTTP**， FTP              |
| 表示层     | **数据格式转换、加密解密**                                   |        | **SSL， TLS**， JPEG， MPEG |
| 会话层     | **建立、管理和终止会话**、断点续传                           |        | NetBIOS， RPC               |
| 传输层     | **复用和分用**、连接的建立与释放、可靠传输管理、差错控制、流量控制 | 报文段 | **TCP， UDP， HTTPS**       |
| 网络层     | **路由选择、分组转发、拥塞控制、网际互联**、连接的建立与释放、可靠传输管理、差错控制、流量控制 | 数据报 | **IP**， ICMP， OSPF        |
| 数据链路层 | **差错控制、流量控制**                                       | 帧     | Ethernet， PPP， HDLC       |
| 物理层     | 定义物理媒介接口的参数，**实现相邻节点比特流传输**           | 比特   |                             |

OSI**网络层**可向上层提供：**有连接可靠的虚电路服务** 和 **无连接不可靠的数据报服务**。

OSI**传输层**可向上层提供有连接可靠的服务TCP协议和无连接不可靠的服务UDP协议 。



### TCP/IP模型

TCP/IP模型是互联网的基础协议套件，它定义了数据如何在网络上打包、寻址、传输、路由和接收。相比OSI七层模型，TCP/IP模型更加简化和实用。

| 层次       | 功能                                                         | 主要协议                                         |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------ |
| 应用层     | 为应用程序提供网络服务，**使用特定协议去实现需要的数据格式转换、加密解密等功能** | **HTTP**， FTP， SMTP， DNS， SSH，Telnet ，POP3 |
| 传输层     | **复用和分用、差错控制、流量控制、连接的建立与释放、可靠传输管理（数据的可靠性全部交给传输层）** | **TCP， UDP**                                    |
| 网络互联层 | **路由选择、分组转发、拥塞控制、网际互联**、~~差错控制、流量控制、连接的建立与释放、可靠传输管理~~ | **IP**， ICMP， ARP， IGMP                       |
| 网络接口层 | ~~定义物理媒介接口的参数~~，**实现相邻节点比特流传输**       | Ethernet， PPP， ARP                             |

TCP/IP **网络层**只提供的**无连接不可靠的数据报服务**，不再进行~~差错控制、流量控制、连接的建立与释放、可靠传输管理~~。

TCP/IP **传输层**可向上层提供有连接可靠的服务TCP协议和无连接不可靠的服务UDP协议 。

> **网络层**提供的两种服务：**面向连接的虚电路服务、无连接的数据报服务**。
>
> 数据包在传输过程中可能会出现误码，也有可能由于路由器繁忙而被路由器丢弃，还有可能出现按序发送的数据包不能按序到达接收方。**如果网络层对于上述传输错误不采取任何措施，则提供的是不可靠传输服务; 如果网络层对于上述传输错误采取措施并使得接收方能正确接收发送方所发送的数据包，则提供的是可靠传输服务。**不同网络体系结构所提供的服务可能是不同的，例如因特网使用的 TCP/IP协议体系的网际层提供的是无连接的不可靠的数据报服务，而ATM、帧中继和X.25的网络层提供的都是面向连接的、可靠的虚电路服务。



### 一般使用的教学模型

![](https://raw.githubusercontent.com/qinshuxiang/repo/main/数据的传输过程.png)



## 物理层

### 数字、模拟信号

信源会通过信道给信宿发送信号，信号是数据的载体，对于计算机网络来说，所谓的数据通常就是二进制的数据，信号有两种类型，一种叫数字信号值是离散的，一种叫模拟信号值是连续的。

**通信流程：信源 -> 数字信号 -> 调制解调器 -> 模拟信号 -> 广域网 -> 模拟信号 -> 调制解调器 -> 数字信号 -> 信宿**。

| **类型**     | **描述**                             | **特点**                             | **示例**             |
| ------------ | ------------------------------------ | ------------------------------------ | -------------------- |
| **数字信号** | 以离散的二进制形式（0和1）表示的信息 | 抗干扰能力强，便于存储和处理         | 计算机数据、数字音频 |
| **模拟信号** | 以连续波形形式表示的信息，如正弦波等 | 适合传递连续的变化，容易受到噪声干扰 | 声音信号             |

**码元**是指在数字通信系统中传输的最小数据单元，它代表一组信息位或数据。例如，在二进制系统中，一个码元通常是一个比特（0或1）。码元的概念广泛用于信号处理、调制与解调过程。`数据速率（bps）= 码元速率（Baud）× 每码元携带的比特数`。

变换器会把二进制数据转换为信号，有可能是数字信号，也有可能是模拟信号。把二进制数据转换成数字信号的过程就叫做编码。

反变换器，把信道上的信号转换成二进制数据，然后交给信宿。反过来把数字信号转换回二进制数据，这个过程就叫解码。

![image-20241019154635299](https://raw.githubusercontent.com/qinshuxiang/repo/main/编码方式.png)

**猫**（光纤调制解调器）本质上是一种**调制解调器**，但其主要功能是将**光纤信号**和**数字信号**之间进行转换。

- **调制（Modulation）**：将**数字信号**（如计算机、手机等设备的数据）转换为**光信号**，以便通过光纤网络传输。
- **解调（Demodulation）**：将光纤网络中的**光信号**转换回**数字信号**，使其可以被计算机或路由器识别和处理。



### 奈奎斯特定理

规定避免码间串扰的低通信道最高码元传输速率。极限码元传输速率=$2\times$​信道带宽，单位为波特。



### 香农定理

描述了在有噪信道中传输数据的**最大信息传输速率**。

香农定理给出了在信噪比受限的通信信道中，无误地传输信息的最大数据速率（即**信道容量**）。

`C = W * Iog_2^（1+S/N）`

- C：信道容量，表示无误传输的最大数据速率（单位：比特每秒，bps）
- W：信道带宽（单位：赫兹，Hz）
- S：信号的平均功率
- N：噪声的平均功率
- S/N：信噪比（Signal-to-Noise Ratio, SNR），常以线性比例表达，而不是分贝（dB）

提升信道带宽、加强信号功率、降低噪声功率，都可以提高信道的极限比特率。



### 传输介质

网络传输介质是指在网络中传输信息的载体，常用的传输介质分为**有线传输介质**和**无线传输介质**两大类。

- 有线传输介质：
  - 双绞线和同轴电缆传输电信号
  - **光纤传输光信号，是传输速度最快、距离最长、抗干扰能力最强且不受监听的计算机网络传输介质**
- 无线传输介质：
  - 无线电波：穿透力强、距离长、信号指向性弱
  - 微波：频率高、信号指向性强
  - 红外线


不同的传输介质，其特性也各不相同。他们不同的特性对网络中数据通信质量和通信速度有较大影响。通常说来，选择数据传输介质时必须考虑5种特性：**吞吐量和带宽、成本、尺寸和可扩展性、连接器以及抗噪性**。

> 有线传输介质的命名规则 速度 + Base + 介质信息
>
> 速度的单位是Mbps，Base表示信号传输方式(**基带传输**)，介质信息若为数字，表示的最大段的长度(百米计)，若为字母表示传输介质类型，**T、TX表示双绞线，F表示光缆**。
>
> 举例：100BASE2  -  100Mbps基带传输，最远传输距离200米



### 物理层接口的特性

在计算机网络体系结构中，**物理层接口**的特性定义了设备之间如何进行物理连接和信号传输。具体分为以下四个方面：**机械特性**、**电气特性**、**功能特性**和**过程特性**。

机械特性描述了物理接口的**外部形状、尺寸、插孔类型**等，与设备的物理连接方式相关。

电气特性描述了接口在传输数据时所需的**电气信号参数**。

功能特性描述了接口的每一个**引脚的功能**及信号的传递方向。

过程特性描述了数据在**传输过程中的时序和操作流程**。



### 物理层设备

#### 1. 中继器

当电压信号或者电流信号在同轴电缆上传输的时候，这些电压值和电流值肯定会受到电阻的影响逐渐的失真，传输的距离越长，这种失真也会越严重，那么在这些条件的限制之下，如果我们想要让网络的覆盖距离更长，就需要使用中继器。**当电压处于一个合理的波动内，中继器可以正确地识别出信号的含义，并且把信号整形再生，然后再发送到下一段链路上**，这样就可以确保最终的目的节点收到的信号失真不会特别严重，至少可以正确的解读出这个信号的含义。

中继器仅支持**半双工通信**，有两个端口，**通过一个端口接收信号，将失真信号整形再生，并转发至另一端口**，这个过程会产生一些时延。它的两个端口对应两个“网段”。使用总线型的拓扑结构。

#### 2. 集线器

**集线器本质上是多端口中继器**。集线器将其中**一个端口接收到的信号整形再生后，转发到所有其他所有端口**。各端口连接的结点不可同时发送数据，仅支持**半双工通信**，不能避免数据冲突的情况。使用总线型的拓扑结构。

其特点包括：

- **广播式发送消息**：所有连接的设备都能接收到信息，信息可能被其他设备接收，导致安全隐患
- **半双工**：不能同时向上和向下传输信息
- **实时性差**：消息传递可能存在延迟



## 数据链路层

数据链路层是计算机网络体系结构中的第二层，主要负责实现数据链路的功能。它需要为网络层提供服务，包括将网络层的分组数据加上首部和尾部的控制信息封装成帧。 同时依赖于物理层提供的比特传输服务，并将帧传输给下一个相邻的节点。 数据链路层实体之间以帧为单位进行数据传输。

### 数据链路层的功能

1. **封装成帧**：将网络层的数据封装成帧，包括**帧定界（恢复原始的SDU）**和**透明传输（使得接收方的网络层感受不到封装成帧的过程）**
2. **差错控制**：发现并解决**帧中**的**位错误**，包括**检错编码**和**纠错编码**
3. **可靠传输**：使用**滑动窗口机制、确认机制、重传机制**发现并解决**帧丢失、帧重复和帧失序**的问题。
4. **流量控制**：控制发送方发送帧的速率，防止接收方来不及接收
5. **介质访问控制**：**实现广播信道的介质访问控制**，防止多个节点争抢传输介质，**点对点信道不需要实现这一功能**



### 封装成帧

**数据链路层的组帧**是指将数据封装成帧，以便在通信链路上传输。每一帧包含控制信息和数据，以确保数据能在网络设备之间正确传递。

1. **接收上层数据**：数据链路层从网络层接收到数据报文
2. **添加帧头和帧尾**：为数据添加控制信息，如源地址、目的地址、**错误校验码**等
3. **生成数据帧**
   - **帧头**：包含控制信息
     - **帧同步**：用于接收端识别帧的开始，如定界符
     - **地址信息**：包含源地址和目的地址
     - **帧类型**：表明该帧**携带的数据类型**
   - **数据部分**：携带从上层接收的实际数据
   - **帧尾**：**包含校验信息，用于检测传输过程中的错误**
4. **将帧发送到物理层**：通过物理链路传输

常见的组帧方法：

1. **字符计数法**：在帧头中添加一个计数字段，表示帧的长度。**缺点**：若计数字段出错，接收方可能无法正确解析帧。
2. **字符填充法**：使用特定字符（如`FLAG`）表示帧的开始和结束。如果数据中出现`FLAG`字符，则通过转义字符进行填充。**应用**：PPP协议。
3. **比特填充法**：使用一系列`0`和`1`的特定比特模式标识帧的边界。如果数据中出现相同模式，则通过比特填充进行处理。**应用**：HDLC协议。
4. **违规编码法**：在编码过程中使用某些非法的编码组合表示帧的开始和结束。**应用**：某些物理层编码方式，如曼彻斯特编码。



### 差错控制

#### 1. 奇偶校验码

奇偶校验码是一种简单的错误检测方式，用于数据传输过程中检测单个比特错误。它通过在数据中添加一个附加位（校验位），根据数据的1的个数来确定该位的值，从而使数据的位数满足奇数或偶数的约定。

如果数据中1的个数为奇数，则校验位为0；如果为偶数，则校验位为1，以保证整个数据的1的个数为奇数。

偶校验：1 ｜ 1010111

**异或：⊕，1 ⊕ 0 = 1**， 0 ⊕ 0 = 0， 1 ⊕ 1 = 1。

奇偶校验码**只能检测出奇数位错误**，无法检测出偶数位错误（出现2的**倍数个**位错误）。**只能检错，不能纠错**。

#### 2. CRC校验码

循环冗余校验（Cyclic Redundancy Check, CRC）是一种用于检测数据传输或存储过程中错误的校验技术。它将数据视为一个多项式，并通过特定的**生成多项式**计算出校验码。在接收端重复这个计算过程，若结果不符，则说明数据在传输中出现了错误。

#### 3. 海明校验码

1. **确定数据和校验位的位置**：

   1. n 位数据需要 k 个校验位，使得 `2^k ≥ n + k + 1`。
   2. 校验位的位置通常放在 1、2、4、8……这些 2 的幂位置上。空余的位置依次填入信息位。
2. **求校验位**
   1. 将信息位的位置**序号**用 k位 二进制数表示。
   2. **位置序号第 i 位为 1** 的信息进行偶校验求得校验位。
3. **纠错**：对各个分组的数进行异或运算

---


举例：如果信息是1010，添加冗余校验位，并且进行校验

```javascript
// 信息是1010
D1 = 0 
D2 = 1 
D3 = 0 
D4 = 1 

// n 位数据需要 k 个校验位, 2^k ≥ n + k + 1
n = 4，那么 k = 3

// H7 H6 H5 H4 H3 H2 H1
// D4 D3 D2 P3 D1 P2 P1
// 1  0  1  P3 0  P2 P1

// 将信息位的位置序号用k位二进制数表示。    
D1 - H3 - 3 二进制数 011 
D2 - H5 - 5 二进制数 101
D3 - H6 - 6 二进制数 110
D4 - H7 - 7 二进制数 111

// 位置序号第 i 位为 1 的信息进行偶校验求得校验位。
- P1 = H3 ⊕ H5 ⊕ H7 = 1 ⊕ 1 ⊕ 0 = 0
- P2 = H3 ⊕ H6 ⊕ H7 = 1 ⊕ 0 ⊕ 0 = 1
- P3 = H5 ⊕ H6 ⊕ H7 = 1 ⊕ 0 ⊕ 1 = 0

// 最后的结果是 1010010

// 正常情况下，对各个分组的数进行异或运算
- S1 = H1 ⊕ H3 ⊕ H5 ⊕ H7 = 0
- S2 = H2 ⊕ H3 ⊕ H6 ⊕ H7 = 0
- S3 = H4 ⊕ H5 ⊕ H6 ⊕ H7 = 0
// 如果接收到的数据是1010000
- S1 = H1 ⊕ H3 ⊕ H5 ⊕ H7 = 0
- S2 = H2 ⊕ H3 ⊕ H6 ⊕ H7 = 1
- S3 = H4 ⊕ H5 ⊕ H6 ⊕ H7 = 0
// 第010位出错，即第二位出现错误，正确返回数据应该是1010010
```

> 基于之前提出的方案，我们是没有办法区分到底是一个比特位的错误，还是两个比特位的错误，我们在最后面的一位添加全体校验位，对整体偶校验。
>
> `S1S2S3 = 000 `且全体偶校验成功，无错误
>
> `S1S2S3 != 000 `且全体偶校验**失败**，有1位错，纠正即可
>
> `S1S2S3 != 000 `且全体偶校验**成功** ，有2位错，需重传



### 流量控制与可靠传输

滑动窗口机制：发送端维护一个窗口，用于限制未确认的数据包数量，接收端根据自身的处理能力调整窗口大小。接收方通过**确认机制**控制发送方的窗口向前滑动，从而实现流量控制。

三种协议本质上都属于滑动窗口机制：

- 停止-等待协议：每次发送一个数据包，等待确认（ACK）后再发送下一个。效率低，信道利用率低。
- 后退N帧协议：发送方可以连续发送多个帧，但必须按顺序接收最后只发送一个确认。**若某帧丢失或出错，则重发该帧及其后所有未确认的帧，往发送端返回最后传输正确的帧编号**。
- 选择重传协议：**不支持累计确认**，发送方只重传丢失或出错的帧，而不是像后退N帧协议那样重发多个帧。

| 窗口大小 | 停止等待协议 | 后退N帧协议 | 选择重传协议 |
| -------- | ------------ | ----------- | ------------ |
| 发送     | =1           | >1          | >1           |
| 接受     | =1           | =1          | >1           |



### 介质访问控制

介质访问控制：控制各节点对传输介质的访问，减少冲突，甚至避免冲突。

1. 信道划分：
   - 时分复用：时间分为等长，信道利用率低
   - 频分复用：将信号频带进行划分多个子频带（Hz），可以同时发送信号
   - 波分复用：相当于光信号版本的频分复用
   - 码分复用：在同一通信信道上同时传输多个信号，每个信号使用**独特的伪随机码（PN码）来进行编码，从而实现信道共享**。假设发送端发送的数据为`1011`，其PN码为`1101`。不同用户的数据在时间和频率上完全重叠，但由于使用了不同的PN码，可以互相区分。这些信号在接收端根据对应的码进行分离。
2. 随机访问：
   - ALOHA：设备在**任何时间都可以发送数据**。若发生冲突，则随机等待一段时间重传
   - CSMA：在发送数据前，设备**先“监听”信道是否空闲**。如果信道忙，则等待；若空闲则发送
   - CSMA/CD：**适用于总线型的局域网**，CSMA基础上，等没人发送数据的时候立马发送数据时，如果检测到冲突，立即停止发送，并随机等待一段时间后重试
   - CSMA/CA：**适用于无线局域网（WIFE）**，发送后不会检测冲突，但会在发送前尽量避免冲突，使用**确认机制**避免冲突。发送方只有在接收到ACK时才认为发送成功
3. 轮询访问：
   - 令牌传递协议：**适用于环形拓扑结构**

> CSMA：载波监听多路访问；CD：冲突检测；CA：冲突避免



### 局域网

IEEE 802委员会在局域网技术的标准化和推广中起到了重要作用。局域网技术最初由科技公司发明，出于商业目的。 IBM公司的令牌环网技术和FDDI曾受到市场认可，但最终被以太网技术超越。局域网以帧为单位在各个节点传输，支持单播、多播、广播。

#### 1. 局域网的分类

1. 以太网：以太网 是当今现有局域网采用的最通用的通信协议标准，局域网依靠以太网技术组网。以太网络使用CSMA/CD(载波监听多路访问及冲突检测)技术，并以10M/S的速率运行在多种类型的电缆上。
   1. 光纤以太网：使用光纤作为传输介质，支持全双工通信，不需要介质访问控制。 
   2. 双绞线以太网：使用双绞线作为传输介质，采用CSMA/CD协议实现介质访问控制。
2. 令牌环网：物理星型，逻辑环型，基本上已经过时。
3. FDDI网：物理双环结构，逻辑环型，使用光纤，造价高，基本上没有使用到。
4. ATM网：较新的单元交换技术，用$53$字节固定长度的单元进行交换。
5. 无线局域网：采用$IEEE802.11$​​标准。

#### 5. 无线局域网

无线局域网基于802.11标准，采用CSMA/CA协议实现介质访问控制。**无线局域网拓扑结构为星型结构，包括一台AP和N台移动设备**。

1. 有固定基础设施
2. 无固定基础设施：地位平等
   - 隔空投送
   - 华为分享

#### 2. MAC子层与LLC子层

IEEE802标准将局域网的数据链路层分为逻辑链路层LLC子层与介质访问控制MAC子层。

- LLC：逻辑链路控制：

  - 建立和释放数据链路层连接、提供与高层接口、差错控制、帧加序号。
  - 为网络层提供服务：无确认无连接、面向连接、带确认无连接、高速传送。
  
- MAC：介质访问控制：

  - 组帧拆帧（根据LLC的序号），帧寻址和识别，竞争处理，比特差错控制等。
- 屏蔽了不同物理链路种类的差异性。

#### 3. ILAN

在计算机网络领域中，**ILAN（Internal Local Area Network）指的是组织内部使用的内部局域网**。这是一个封闭的、私有的网络系统，通常被企业、政府机构或学校用于内部通信。与互联网相比，ILAN的特点是安全性更高，且大多**不直接向公共网络暴露**。

**1. 高安全性**

- **内部访问控制**：通过身份认证、加密等手段限制访问，防止未经授权的访问。**对用户可以分别实施管理**。
- **减少数据泄露**：所有数据在内网传输，不会暴露在公共网络中。与外部互联网隔离，减少外部网络攻击的风险。
- **集中管理**：网络管理员可以轻松监控网络流量和设备状态。追踪访问记录和异常行为，快速发现并解决问题。通过 DHCP 和 DNS 服务自动管理 IP 地址和域名解析。

**2. 高性能和低延迟**

- **快速数据传输**：局域网内的数据传输速率通常更高（如 1Gbps 或 10Gbps）。
- **低延迟**：适用于实时通信或高频率数据交换，如视频会议和文件共享。
- **高可用性**：自动切换备用设备。降低单个设备或服务的重复部署成本。内部网络用户可以高效共享资源（如文件服务器、数据库和打印机）。**减少了网络流量，提高了网络利用率**。

**3. 可扩展性与灵活性**

- 通过 **VLAN** 和子网划分，可以将网络细分为多个逻辑区域，适应不同部门的需求。**扩展了通信范围**。
- 可根据业务需求扩展网络设备和服务，而不会影响现有网络的**稳定性**。**冗余备份机制，减少停机时间，提高业务连续性。**

#### 4. VLAN

VLAN是虚拟局域网。VLAN技术用于将局域网划分为多个虚拟网络**，每个虚拟网络具有独立的广播域**。VLAN的引入可以解决传统大型局域网面临的问题，如广播风暴和安全性问题。

传统大型局域网面临的问题：

1. 广播风暴：当局域网规模较大，连接节点数较多时，广播帧的出现频率增加，导致网络数据传输和节点处理负载过高，可能引发广播风暴。
2. 安全性问题：在传统局域网中，所有节点都暴露在同一个广播域内，高敏感节点如服务器和数据中心可能受到黑客攻击。

VLAN的解决方案：

1. **将局域网内部的节点重新分组，划分为不同的虚拟局域网**。
2. 每个VLAN是一个独立的广播域，**节点只能与其属于同一个VLAN的节点进行通信**。 
3. 提升网络的安全性，通过**将敏感节点划分到单独的VLAN中，限制其他节点的访问**。

VLAN的划分方式

1. **基于接口划分**：交换机管理员**配置VID和接口号的映射关系**，节点通过连接的接口确定所属VLAN。 
2. **基于MAC地址划分**：交换机管理员**配置VID和MAC地址的映射关系**，节点即使更换接口也属于同一个VLAN。 
3. **基于IP地址划分**：通过**IP地址和VID的映射关系**划分VLAN，可以跨越路由器，连接多个局域网的主机。



### 广域网

#### 1. PPP协议

**PPP**（Point-to-Point Protocol，点对点协议）是一种数据链路层协议，用于在两个网络节点之间直接传输数据。

- **封装多种协议**：PPP能够封装多种网络层协议（如IP、IPX等）。
- **链路控制**：使用**链路控制协议（LCP）**来建立和维护链路。
- **身份验证**：支持**PAP**（密码认证协议）和**CHAP**（挑战握手认证协议）进行身份验证。
- **数据压缩**：可以使用压缩协议来减少数据量，提高传输效率。
- **错误检测**：通过帧校验和（FCS）确保数据的完整性。

PPP协议的组成：

1. 一个将IP数据报封装到串行链路（同步或异步）的方法。
2. 链路控制协议LCP：建立并维护数据链路连接，并进行身份验证。
3. 网络控制协议NCP：$PPP$支持多种网络层协议，每个不同的网络层协议都需要一个相应的NCP来配置，为网络层建立和配置逻辑连接。

#### 2. HDLC协议

**HDLC**（High-Level Data Link Control）是一种广泛使用的同步数据链路层协议，最初由ISO（国际标准化组织）定义。它用于在点对点或点到多点的通信链路上进行数据传输。

1. 主站：发送命令（包括数据信息）帧、接收响应帧，并负责对整个链路的控制系统的初启、流程控制、差错检测或恢复。
2. 从站：接收由主站发来的命令帧，向其发送响应帧，并配合主站参与差错恢复等链路控制。
3. 复合站：既能发送，又能接收命令帧和响应帧，并负责整个链路的控制。

**主要功能**：

- **数据帧的定义**：HDLC定义了数据帧的格式，包括帧头、数据和帧尾。
- **流量控制**：提供基本的流量控制机制，确保发送端和接收端的数据传输协调。
- **错误检测**：通过帧校验和（FCS）进行错误检测，确保数据传输的完整性。
- **链路管理**：支持链路建立、维护和终止的管理功能。



###  冲突域与广播域

- 冲突域：在以太网中，如果某个CSMA/CD网络上的两台计算机在同时通信时会发生冲突（即同一时间只能一台主机发送信息），那么这个CSMA/CD网络就是一个冲突域。如果以太网中各个网段以集线器连接，因为不能避免冲突，所以它们仍然是一个冲突域。
- 广播域：网络中能接收任一设备发出的广播帧的所有设备的集合。即如果一个站点发出一个广播信号，那么所有能接收到该信号的设备范围就是一个广播域。（一个网络层设备一个广播域）
- 网段：指一个计算机网络中使用同一物理层设备（传输介质、中继器、集线器等）能直接通信的一部分。

一个网段就是一个冲突域，一个局域网就是一个广播域。

|            | 能否隔离冲突域 | 能否隔离广播域 |
| ---------- | -------------- | -------------- |
| 物理层设备 | 否             | 否             |
| 链路层设备 | 是             | 否             |
| 网络层设备 | 是             | 是             |



### 数据链路层设备

#### 1. 网桥

**以太网通过网桥连接后就形成了更大的以太网，原来的每个以太网就是一个网段**。可以互联不同的物理层、不同的MAC子层及不同速率的以太网。网桥工作在数据链路层的MAC子层。当网桥收到一个帧时，不会广播此帧，而是先检测该帧的目的MAC地址，然后确定转发到哪一个接口或丢弃（过滤）。

简单地说网桥类似于中继器，**网桥要分析帧地址字段，以决定是否把收到的帧转发到另一个网络段上。**

#### 2. 交换机

交换机是比集线器更为智能的设备，能够记录不同设备的唯一标识——MAC地址。其主要特点包括：

- **MAC地址表**：交换机记录每个端口的MAC地址，形成映射表。**具有自学习功能**。
- **点对点发送**：根据MAC地址进行信息的直接转发。**交换机用于局域网，利用主机的MAC地址进行数据传输，而不需要关心IP数据包中的IP地址。**
- **全双工模式**：允许同时进行双向信息传输。不同于集线器解决了数据冲突的问题。
- **桥接支持**：可以实现多个交换机之间的信息交换。

然而，随着网络规模的扩大，可能出现以下问题：

- **表溢出**：新MAC地址覆盖旧地址，导致信息无法正确发送。
- **冗余链路**：可能引发广播风暴和环路问题。

> **交换网环路**是指在以太网交换网络中，**存在多条路径连接同一组交换机**，从而形成一个**物理环路**。环路可能导致数据包在网络中无限循环，造成**广播风暴**、**MAC地址表抖动**和**网络拥塞**，严重影响网络的正常通信。

交换机主要的功能是**增加传输带宽、降低网络传输的延迟，进行网络管理，以及选择网络传输线路**。交换机工作在OSI参考模型的**数据链路层**。

> **链路聚合**是一种将**多条物理链路捆绑成一条逻辑链路**的技术，以提高网络的**带宽、冗余性**和**可靠性**。即使某条物理链路发生故障，其他链路仍能继续传输数据，从而提高网络的可用性。
>
> 1. **带宽增加**：多条链路并行传输数据，提高总体带宽。
> 2. **冗余性**：即使一条或多条链路故障，其他链路仍能正常工作。
> 3. **负载均衡**：将流量分布在多条链路上，避免单链路拥塞。
> 4. **故障恢复**：当一条链路失效时，流量自动切换到剩余链路上，无需人工干预。
>
> **网络冗余设计**避免网络组件单点失效造成应用失效，**主路径比备用路径承担更多的的网络负载**，负载分担是通过并行链路提供流量分担来提供性能 ，网络中存在备用链路时可以考虑加入负载分担设计

#### 3. 网络适配器

**网络适配器即网卡**，是用于将计算设备（如计算机、服务器、IoT设备）连接到网络的一种硬件组件或软件驱动程序。它**负责在设备与网络之间传输数据**，实现有线或无线通信，工作在OSI七层模型中的**数据链路层**。

> 网卡工作在数据链路层，转发和接受数据帧，因为其连接的传输介质在物理层，所以也可以说网卡主要实现的功能在物理层与数据链路层。

**每个网卡都有一个唯一的MAC地址，用于在局域网中标识设备**。

网卡的工作方式：网卡接收来自计算机的数据，并将其转换为网络可以理解的格式。接收到的数据通过网卡的驱动程序送入计算机，进行处理。



## 网络层

### 网络层的功能
#### 1. 异构网络互联

网络层使**不同类型的网络**（如以太网、无线网、光纤网络）能够互联，通过**IP地址**将不同网络的主机进行标识，使得数据包能够在多种物理网络之间传输。采用**IP协议**作为标准协议，**统一处理数据包格式和地址，使异构网络之间无缝对接**。

#### 2. 路由选择与分组转发

网络层通过**路由选择算法**（如RIP、OSPF、BGP等）找到从源地址到目标地址的最优路径。使用**路由表**存储路径信息，通过动态更新保证数据传输的高效性和正确性。数据包在通过路由器时根据目标IP地址查找路由表，并决定通过哪个接口转发数据。

**静态路由**由管理员手动配置，适合小型网络；**动态路由**适合大型网络，可根据网络拓扑变化自动更新。

#### 3. 拥塞控制

拥塞控制用于防止网络中由于数据流量过大导致的性能下降或丢包。

常见的拥塞控制机制包括：

1. **源端控制**：如TCP协议中的慢启动和拥塞避免算法，通过调节发送速率来减少拥塞。
2. **网络设备控制**：路由器可以使用**队列管理算法**（如RED、WFQ）对流量进行调节。
3. **拥塞告警机制**：路由器检测到拥塞时，向发送方发送告警信息，使其降低数据发送速率。
4. **流量工程**：在大型网络中，通过优化路径和负载均衡来减少某些链路的过载。



### IPV4

#### IP分组格式

IP数据报头部固定部分包含20个字节的内容，可变部分可能为空，最大不超过40个字节。

1. **版本**　占4位，指IP协议的版本。通信双方使用的IP协议版本必须一致
2. **首部长度**　**占4位**，可表示的最大十进制数值是15
3. **区分服务**　**占8位**，用来获得更好的服务
4. **总长度**　总长度指首部和数据之和的长度，单位为字节。**总长度字段为16位**
5. **标识(identification)**　占16位。IP软件在存储器中维持一个计数器，每产生一个数据报，计数器就加1，并将此值赋给标识字段。
6. **标志(flag)**　占3位，但只有2位有意义。
7. **片偏移**　占13位。片偏移指出：较长的分组在分片后，某片在原分组中的相对位置。
8. **生存时间**　占8位，生存时间字段常用的的英文缩写是TTL，表明是数据报在网络中的寿命。由发出数据报的源点设置这个字段。
9. **协议**　占8位，协议字段指出此数据报携带的数据是使用何种协议，以便使目的主机的IP层知道应将数据部分上交给哪个处理过程。
10. **首部检验和**　占16位。检验数据报的首部，数据报每经过一个路由器，路由器都要重新计算一下首部检验和。
11. **源地址**　占32位。
12. **目的地址**　占32位。

**如果IP数据报的总长度大于下一链路的的MTU，那么就需要把IP数据报的数据部分进行分片。**

**一个IP分组每经过一台路由器，这个路由器就会把TTL- 1。如果TTL值已经减到零，那么这台路由器就会直接把IP分组给丢掉，并且向原主机发送ICMP报文（通知出现异常）**。



#### IP地址分类

最初的IP地址主要由网络部分和主机部分组成。对于IPv4地址，它通常表示为四个十进制数字（例如，192.168.1.1），每个数字范围在0到255之间。网络部分标识特定的网络，而主机部分标识该网络内的具体设备。使用子网掩码可以进一步划分网络和主机部分。

| 类别 | 地址范围                    | 说明                  | 网络地址      | 网络号 | 主机号 | 默认子网掩码  |
| ---- | --------------------------- | --------------------- | ------------- | ------ | ------ | ------------- |
| A    | 1.0.0.0 - 126.255.255.255   | 大型网络，首位为0     | 1 - **126**   | 7      | 24     | 255.0.0.0     |
| B    | 128.0.0.0 - 191.255.255.255 | 中型网络，前两位为10  | 128 - **191** | 14     | 16     | 255.255.0.0   |
| C    | 192.0.0.0 - 223.255.255.255 | 小型网络，前三位为110 | 192 - **223** | 21     | 8      | 255.255.255.0 |
| D    | 224.0.0.0 - 239.255.255.255 | 多播地址              |               |        |        |               |
| E    | 240.0.0.0 - 255.255.255.255 | 预留地址，用于科研    |               |        |        |               |

特殊的网络地址：

- 网络号固定，主机号全为0，代表网络本身，只能用于路由表、转发表
- 网络号固定，主机号全为1，代表一个广播地址
- 网络号全0，主机号固定，可以作为源地制，但是不可以作为目的地址，本网络中的主机号为Y的主机（刚接入网络未分配IP地址，在DHCP协议中使用）
- 网络号全0，主机号全0，本网络上的本主机
- 网络号全1，主机号全1，向本网络上的所有主机广播

> C类网络的网络号为24位，主机号为8位，故可安装2^8=256台主机，**但是全为0的主机号表示该IP地址是“本主机”所连接到的单个网络地址，全为1的主机号字段表示该网络上的所有主机**，这两种情况要去掉，所以可以安装254台主机。



#### 子网划分

子网划分是通过借用IP地址的若干位主机位来充当子网地址从而将原网络划分为若干子网而实现的。划分子网时，随着子网地址借用主机位数的增多，子网的数目随之增加，而每个子网中的可用主机数逐渐减少。

以C类网络为例，原有8位主机位，2的8次方即256个主机地址，默认子网掩码255.255.255.0。借用1位主机位，产生2个子网，每个子网有126个主机地址;借用2位主机位，产生4个子网，每个子网有62个主机地址……每个子网中，**第一个IP地址(即主机部分全部为0的IP)和最后一个IP(即主机部分全部为1的IP)不能分配给主机使用，所以每个子网的可用IP地址数为总IP地址数量减2**。

如果一个网络进行了子网划分，那么这个网络中的每台计算机、路由器接口都需要**配置IP地址、默认网关、子网掩码**。

> 要将 B 类网络 `135.41.0.0/16` 划分为 20 个能容纳 200 台主机的子网，我们首先需要计算合适的子网掩码。
>
> 第一种方式：考虑主机数
>
> 1. **每个子网需要容纳 200 台主机**，加上网络地址和广播地址，总共需要 202 个地址。
>
> 2. 计算可以提供的地址数量：
>
>    - 使用公式：`2^n - 2 >= 202`，其中 `n` 是主机部分的位数。
>    - `2^8 - 2 = 256 - 2 = 254`，满足条件，所以需要 8 位来表示主机部分。
>
> 3. 原始掩码是 /16，现在需要将 8 位用于主机，剩下的部分作为网络部分：
>
>    - `16 + (8 - 8) = 24`
>
>    - 因此，新子网掩码为 `/24`（即 `255.255.255.0`）。
>
>    - 由于我们需要 20 个子网，可以将其划分为 `/24` 的子网，每个子网可容纳 254 台主机。
>
> 第二种方式：考虑子网数量
>
> 1. 需要20 个能容纳 200 台主机的子网
> 2. `2^4 < 20 < 2^5`，所以可以分配5个主机位给网络位，新子网掩码为 `/21`，每个子网可以容纳 2046 台主机



#### 子网掩码

对网络进行子网划分后，子网掩码是一个32位的二进制数，其对应网络地址的所有位置都为1，对应于主机地址的所有位置都为0。**将子网掩码和IP地址按位进行逻辑“与”运算，得到IP地址的网络地址**，剩下的部分就是主机地址，从而区分出任意IP地址中的网络地址和主机地址。

> 例如：有两台主机，主机1的IP地址为222.21.160.6，子网掩码为255.255.255.192，主机2的IP地址为222.21.160.73 子网掩码为255.255.255.192。主机1要给主机2发送数据，先要判断两个主机是否在同一网段。
>
> 主机1在发送数据时，会将目标主机2的IP地址**与自己的子网掩码**进行与运算，以确定目标主机是否在同一子网内。如果在同一子网内，则直接发送；否则，数据包会发送到默认网关。
>
> 对于主机1： IP: 222.21.160.6
>
> IP:                                   **11011110.00010101.10100000**.00000110 
>
> 子网掩码:                        11111111.11111111.11111111.11000000 
>
> 按位与运算后的结果：  **11011110.00010101.10100000**.00000000 
>
> 即网络地址：222.21.160.0
>
> 对于主机2： IP: 222.21.160.73
>
> IP:                                    **11011110.00010101.10100000**.01001001 
>
> 子网掩码:                         11111111.11111111.11111111.11000000 
>
> 按位与运算后的结果：   **11011110.00010101.10100000**.01000000 
>
> 即网络地址：222.21.160.64
>
> 由于两台主机的网络地址不同，所以它们不在同一网段。因此，它们之间的通信需要通过路由器或其他网络设备来实现。
>
> ps：在计算的时候，子网掩码全为1的部分只需要关注IP为1的部分

默认路由是路由器转发表中的默认项，目的网络号为全零，子网掩码也为全零。 当转发表中所有表象都无法匹配时，默认路由会生效，确保IP数据包能够被正确转发。**默认路由通常用于将IP数据包发送到默认网关或互联网上的下一个路由器**。



#### 数据处理流程

1. 主机在发送IP数据包时，首先判断目的IP地址是否与本机在同一网络。 通过检查目的IP地址和自己的IP地址网络前缀。是否相同。只有网络前缀相同的两个IP地址是属于同一个网络，如果网络前缀不同，那么就属于不同的网络。
2. 如果目的主机在同一网络，则直接封装MAC帧并通过ARP协议获取目的主机的MAC地址。 
3. 如果目的主机不在同一网络，则通过ARP协议获取默认网关的MAC地址，并将IP数据包发送给默认网关。
4. 路由器在收到IP数据包时，会检查目的IP地址并查找转发表以确定转发接口。
5. 如果转发表中有匹配的表象，则将IP数据包从对应接口转发出去；否则，使用默认路由进行转发。



#### 无分类编址

CIDR技术取消了传统的IP地址分类方式，采用无分类编址方案，IP地址分为网络前缀和主机号两部分，网络前缀可变长。CIDR记法用斜线表示网络前缀的长度，如192.168.1.1/24。

**CIDR包含定长子网划分，变长子网划分两种技术**，变长子网划分最少需要五个闲置的IP地址，全0地址、全1地址、两个主机地址、默认网关地址。

![14411729654194_.pic](https://raw.githubusercontent.com/qinshuxiang/repo/main/动长子网划分.jpg)

> 例如：若将 101.200.16.0/20 划分为5个子网，则可能的最小子网的可分配正地址数是多少。
>
> 地址位可分配位数为12
>
> - 0
>   - 0
>     - 0
>       - **- 0**
>       - **- 1**
>     - **- 1**
>   - **- 1**
> - **- 1**
>
> 要划分5个子网，意味着构造的哈夫曼树包含5个叶子节点，要让一个子网尽可能的小，就得让一个叶子节点尽可能的深
>
> 最深的叶子与根节点距离为4，意味着最小的子网，需要从原CIDR地址块中，拿出4位作为子网号，剩下8位作为该子网的主机号
>
> 最小子网可分配的IP地址数 = `2^8 - 2 = 254`



#### 路由聚合

网络层中的**路由聚合**（Route Aggregation）是一种通过将多个相邻网络地址合并为一个更大的地址前缀来减少路由表规模的技术。它也被称为**路由汇总**（Route Summarization）。通过减少路由表中的条目数量，路由聚合可以提高路由器的性能，降低网络中广播更新的频率，并提升网络的稳定性。

例如：在同一个计算机网络中的128.14.32.128/28、128.14.32.144/29、128.14.32.152/30，**路由表的转发接口相同**，转化为二进制后只有最后的5位不同，**部分网络前缀也相同**

10000000.00001110.00100000.100**00000**

10000000.00001110.00100000.100**10000**

10000000.00001110.00100000.100**11000**

可以统一表示为 128.14.32.128/27，这样的地址聚合叫做路由聚合，也称为**构成超网**。对于都可以匹配的接口遵循最长前缀匹配原则。



#### 网络地址转换

**NAT** 是一种将 **私有网络 IP 地址**转换为 **公共 IP 地址**的技术，用于在局域网和互联网之间进行数据传输。NAT 常用于缓解 IPv4 地址不足的问题，并提升网络的安全性。只需要保证在内网唯一，不需要在外网唯一。

**私有网络预留了三个IP地址块**，这些地址不会在因特网上被分配。

- A类：**10**.0.0.0～10.255.255.255

- B类：**172.16**.0.0～**172.31**.255.255 

- C类：**192.168**.0.0～**192.168**.255.255

- **即 10.开头，172.16-172.31以内，192.168开头**

**NAT路由器的NAT表包含有外网的IP地址、端口号、内网的IP私有地址、端口号来进行一一对应。**通过NAT路由器将内网IP地址映射为外网IP地址。



#### IPv6

为了扩大地址空间，拟通过IPv6重新定义地址空间。IPv4采用32位地址长度，而IPv6采用128位地址长度，几乎可以不受限制地提供地址。

IPv6的主要优势体现在以下几方面

1. **更大的地址空间**。IPv4中规定IP地址长度为32，而IPv6中IP地址的长度为128。
2. **更小的路由表**。IPv6的地址分配一开始就遵循聚类的原则，这使得路由器能在路由表中用一条记录表示一片子网，大大减小了路由器中路由表的长度，提高了路由器转发数据包的速度。
3. **增强的组播**支持以及对流的控制，这使得网络上的多媒体应用有了长足发展的机会，为**服务质量(QoS)**控制提供了良好的网络平台。
4. **自动配置的支持**。这是对DHCP协议的改进和扩展，使得网络(尤其是局域网)的管理更加方便和快捷。
5. **安全性**。在使用IPv6网络中用户可以对网络层的数据进行加密并对IP报文进行校验，在IPV6中的加密与鉴别选项提供了分组的保密性与完整性。极大的增强了网络的安全性。

> IPV6省略写法
>
> 1. 去除前导零在每个组中**前导的零可以省略**。例如：2001:0db8:0000:0000:0000:0000:0000:0001可以简化为2001:db8:0:0:0:0:0:1
> 2. 使用双冒号 :: 代替连续的零组，如果地址中有多个连续的零组，可以用 :: 来代替，**只能在地址中使用一次**。例如2001:0db8:0000:0000:0000:0000:0000:0001可以简化为 2001:db8::1

IPv6 转换为 IPv4 的策略通常涉及以下几种方法：

1. 双栈：在网络设备上同时启用 IPv4 和 IPv6。支持 IPv4 和 IPv6 的设备能够无缝通信。
2. 隧道: 在 IPv4 网络中封装 IPv6 数据包。例如使用 6to4 或 Teredo 隧道。可以在现有的 IPv4 基础设施上传输 IPv6 数据。**隧道协议中工作在网络层的是IPSec，IPSec协议具有身份认证功能，可以拒绝DOS攻击**



### 路由算法

#### 1. 静态路由与动态路由

**静态路由**：由网络管理员手动配置，并在路由表中永久保存。不适应网络拓扑的变化，需要手动更新路由，维护成本较高。

**动态路由**：使用**动态路由协议**（如RIP、OSPF、BGP）自动计算和更新路由表。占用一定的网络带宽和计算资源，协议复杂度较高。

#### 2. 距离-向量路由算法：

每个路由器通过邻居的信息来更新自己的路由表，并将自己的路由信息周期性地发送给相邻路由器。**算法简单**，但容易出现**路由环路**问题。路由器只知道与自己相邻的节点信息，并通过跳数来衡量路径优劣。**收敛速度慢**，尤其在网络拓扑发生变化时。受限于最大跳数（RIP的最大跳数为15），不适合大型网络。

#### 3. 链路状态路由算法

每个路由器获取整个网络拓扑的状态信息，并独立计算最短路径。典型协议： **OSPF（开放最短路径优先）** 。每个路由器维护一张**链路状态数据库（LSDB）**，其中存储整个网络的拓扑信息。使用**Dijkstra算法**计算最短路径。收敛速度快，适合大型复杂网络。能动态适应网络变化，提供更优的路径选择。**实现复杂**，需要更多的内存和计算资源。由于需要广播链路状态信息，占用一定的网络带宽。

#### 4. 层次路由

**将网络划分为多个区域或自治系统（AS）**，减少路由表的规模和计算复杂度。由器只维护其所在区域的详细信息，对于其他区域仅知道如何到达它们。**减少路由表的大小**，提高路由效率。降低网络收敛时间，避免全局路由更新的开销。



### IP组播

#### 组播的概念

IP组播（IP Multicast）是一种在IP网络中实现多点传送的方法，即通过一次发送，将数据传递给多个接收者。与单播（Unicast，点对点）不同，组播允许源节点将数据发往一组特定的接收者，避免重复发送，提高网络的效率。

#### IP组播地址

IP组播使用特定的地址范围：**224.0.0.0/4**，即从224.0.0.0到239.255.255.255。不同的地址段用于不同的用途：

| 地址范围                    | 用途                                 |
| --------------------------- | ------------------------------------ |
| 224.0.0.0 - 224.0.0.255     | 局部链路组播（本地路由器之间的通信） |
| 224.0.1.0 - 238.255.255.255 | 全局组播，跨子网的组播通信           |
| 239.0.0.0 - 239.255.255.255 | 私有组播地址，类似私有IP地址         |

组播地址和单播地址一样是IPv4地址，但组播地址只代表一组设备，而不是单一设备。



### 移动IP

#### 移动IP的概念

移动IP（Mobile IP）是一种支持设备在不同网络之间无缝切换**而不改变其IP地址的技术**。它允许移动设备（如笔记本、智能手机等）在不同的网络环境下自由移动，而不会中断与其他设备的通信。

移动IP主要解决了设备**在切换网络时保持通信不中断**的问题。核心机制是通过将通信绑定到一个固定的“归属地址”，无论设备连接到哪个网络，它都能通过这个归属地址进行通信。

#### 移动IP的通信过程

移动IP的通信过程涉及两个关键角色：

1. **归属代理（Home Agent, HA）**：位于移动节点的归属网络，负责转发数据包。
2. **外部代理（Foreign Agent, FA）**：位于当前访问的外部网络，协助与归属网络通信。

**通信流程**

1. **注册阶段**：
   - 移动节点（Mobile Node, MN）进入新的外部网络后，与外部代理（FA）注册。
   - 外部代理将MN的当前位置通知归属代理（HA）。
2. **数据传输**：
   - 当有数据发往移动节点时，数据首先送达归属代理（HA）。
   - HA将数据封装后，通过隧道（tunneling）转发到移动节点所在的外部代理（FA）。
   - 外部代理解封数据，并将其交付给移动节点。
3. **切换网络**：
   - 如果移动节点再次切换到其他网络，会重新注册新的外部代理。
   - 通信会自动更新为通过新的路径传输，而不会影响通信的连续性。



### 常见的网络端口

以下是对不同网络端口的详细说明，涵盖其功能、用途和连接方式：

1. RJ-45 端口

   - **类型**：以太网端口

   - **应用**：用于连接局域网，常见于网络交换机和路由器。

   - **连接方式**：使用双绞线（通常为CAT5或CAT6）连接网络设备。
2. 高速同步串口

   - **类型**：串行端口

   - **应用**：用于路由器与广域网（WAN）的连接，支持DDN、帧中继、X.25和PSTN等网络。

   - **特点**：同步传输，数据速率较高，适合需要实时数据传输的场景。
3. 异步串口（ASYNC）

   - **类型**：串行端口

   - **应用**：主要用于与调制解调器或Modem池的连接，以实现远程计算机通过PSTN拨号接入。

   - **特点**：数据传输速率较低，不要求同步，常用于旧版设备或低带宽需求的应用。
4. ISDN BRI 端口

   - **类型**：数字用户线路

   - **应用**：通过ISDN线路连接路由器与Internet或其他网络。

   - **连接方式**：采用RJ-45标准，与ISDN NT1设备连接时使用RJ-45-to-RJ-45直通线。

   - **特点**：支持语音和数据同时传输，适合小型企业。
5. Console 端口

   - **类型**：控制端口

   - **应用**：通过专用电缆连接至计算机的串口，利用终端仿真程序进行路由器的本地配置。

   - **连接方式**：路由器的Console端口为RJ-45口。

   - **特点**：用于设备初始配置和故障排除，通常在没有网络连接的情况下使用。
6. AUX 端口

   - **类型**：辅助控制端口

   - **应用**：用于路由器的远程配置。

   - **连接方式**：外观与RJ-45端口相似，但内部电路不同。与调制解调器连接时需要使用RJ-45 to DB9或RJ-45 to DB25适配器进行转换。

   - **特点**：支持硬件流控，常用于拨号访问路由器进行管理和配置。
7. 光纤端口（SC 端口）

   - **类型**：光纤连接端口
   - **应用**：用于高速网络连接，特别是连接服务器的光纤网卡。可提供千兆数据传输速率。
   - **特点**：SC端口以其可靠性和易于连接的特性而广泛应用于数据中心和企业网络。
8. GBIC 端口

   - **类型**：可插拔模块
   - **应用**：用于安装GBIC模块，支持千兆位网络连接。
   - **功能**：GBIC模块将电信号转换为光信号，实现网络信号的传输。
   - **特点**：GBIC模块是热插拔的，便于在网络运行中进行更换和维护。
9. SFP 端口

   - **类型**：小型可插拔模块
   - **应用**：与GBIC类似，但体积更小，适用于空间有限的设备。
   - **功能**：SFP模块同样将电信号转换为光信号，用于千兆位及更高速度的网络连接。
   - **特点**：体积减少一半，相较于GBIC，更加节省空间，适合现代高密度网络环境。

带电插拔，热插拔功能就是允许用户在不关闭系统，不切断电源的情况下取出和更换损坏的硬盘、电源或板卡等部件，从而提高了系统对灾难的及时恢复能力、扩展性和灵活性等。

热备份是指在联机（运行）状态下备份应用系统或数据库进行备份，与之对应的是冷备份，冷备份是指在未联机（关机）状态下对应用系统或数据库进行备份。

热恢复是指应用系统发布后，发现了bug，如果重新发布则导致用户体验不好等不良后果，因此采用热修复的方法去除bug，而不影响应用系统的使用。



### 常见协议

#### IP

IP协议是互联网的核心。传输层TCP、UDP协议需要IP协议的支持，网络层ICMP与IGMP同样需要。

![](https://raw.githubusercontent.com/qinshuxiang/repo/main/协议之间的关系.jpg)

**IP提供的是一种不可靠的无连接报文分组传送服务**，它是为了实现相互连接的计算机进行通信设计的协议，它实现了**自动路由功能，即自动寻径功能。**

#### ARP

用于根据 **IP 地址**查找设备的 **MAC 地址**，确保数据包能够在局域网中正确传输。

> 首先，**每台主机都会在自己的ARP缓冲区中建立一个ARP列表，以表示IP地址和MAC地址的对应关系**。当源主机需要将一个数据包要发送到目的主机时，会首先检查自己ARP列表中是否存在该IP地址对应的MAC地址。如果有，就直接将数据包发送到这个MAC地址。**如果没有，就向本地网段发起一个ARP请求的广播**，查询此目的主机对应的MAC地址。此ARP请求数据包里包括**源主机的IP地址、硬件地址、以及目的主机的IP地址**。
>
> 网络中所有的主机收到这个ARP请求后，会检查数据包中的目的IP是否和自己的IP地址一致。如果不相同就忽略此数据包；**如果相同，该主机首先将发送端的MAC地址和IP地址添加到自己的ARP列表中，如果ARP表中已经存在该IP的信息，则将其覆盖，然后给源主机发送一个ARP响应数据包，告诉对方自己是它需要查找的MAC地址**；源主机收到这个ARP响应数据包后，将得到的目的主机的IP地址和MAC地址添加到自己的ARP列表中，并利用此信息开始数据的传输。如果源主机一直没有收到ARP响应数据包，表示ARP查询失败。

#### RARP

用于根据 **MAC 地址**查找设备的 **IP 地址**。

> RARP协议(反向地址转换协议)就是将局域网中某个主机的物理地址转换为IP地址，局域网中有一台主机只知道物理地址而不知道IP地址，那么可以**通过RARP协议发出征求自身IP地址的广播请求，然后由RARP服务器负责回答**。RARP协议广泛用于获取无盘工作站的IP地址。

#### ICMP

ICMP是Internet控制报文协议。它是TCP/IP协议簇的一个子协议，用于在IP主机、路由器之间传递控制消息。**控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息**。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。

ICMP提供一致易懂的出错报告信息。发送的出错报文返回到发送原数据的设备，因为只有发送设备才是出错报文的逻辑接受者。发送设备随后可根据ICMP报文确定发生错误的类型，并确定如何才能更好地重发失败的数据包。但是ICMP唯一的功能是报告问题而不是纠正错误，纠正错误的任务由发送方完成。

#### DHCP

DHCP：动态主机配置协议，是一个应用层协议。当我们将客户主机IP地址设置为动态获取方式时，DHCP服务器就会根据DHCP协议给客户端分配IP，使得客户机能够利用这个IP上网。DHCP客户端能从DHCP服务器获得**DHCP服务器地址和DNS服务器地址**。

**源地址：0.0.0.0**，**目的地址：255.255.255.255**，向网络广播。

> **自动专用IP地址**（APIPA, Automatic Private IP Addressing）是一种用于**本地网络的自动IP地址分配**机制。它是在设备无法从DHCP服务器获取IP地址时，自动分配的一个备用地址。APIPA的主要特点和机制如下：
>
> 1. **地址范围**：APIPA的地址范围是`169.254.0.1`到`169.254.255.254`，子网掩码为`255.255.0.0`。这是一个**专用地址段**，用于本地局域网通信，不能通过路由器访问外网。
> 2. 这种机制适合于**小型对等网络**，在缺少DHCP服务器时，确保设备之间仍可以通信。
> 3. 当设备启动时，尝试从DHCP服务器获取IP地址。如果多次尝试失败，设备会从APIPA范围中**随机选择一个地址**。
> 4. 设备会通过ARP（地址解析协议）检查选定地址是否已被使用，若未被占用，则配置该地址。

#### RIP

RIP（路由信息协议）是一种距离向量路由协议，使用跳数作为路由选择的度量标准。是最早的动态路由协议之一。**最大跳数限制**：最大跳数为 15，超过 15 跳的网络被视为不可达。**定期更新**：每 30 秒广播路由更新信息。

#### OSPF

**OSPF（开放最短路径优先）** 是一种内部网关协议（IGP），使用链路状态算法进行路由选择。



### 网络层设备

#### 1. 路由器

**路由器**是一种网络设备，位于不同网络之间，负责数据包的转发和路由选择。它使用路由表和路由协议，决定从一个网络发送的数据包应如何到达另一个网络。路由器广泛用于家庭、企业和互联网骨干网络中，是实现不同网络之间互联的关键设备。**路由器与广域网连接的端口称为WAN端口，路由器与局域网连接的端口称为LAN口。**

路由器处在**网络层**，是**连接因特网中各局域网、广域网的设备，它会根据信道的情况自动选择和设定路由器，以最佳路径，按前后顺序发送信号**。其重要功能包括：

1. **路由选择**：根据路由表选择最佳路径，将数据包转发到目标网络。
2. **数据转发**：负责将数据包从一个接口转发到另一个接口，确保数据包能到达目的地。
3. **地址转换（NAT）**：将内部私有IP地址转换为公网IP地址，实现局域网设备访问互联网。
4. **防火墙与访问控制**：提供基本的网络安全功能，控制数据包的进出，防止非法访问。
5. **QoS（服务质量）**：路由器可对不同类型的流量进行优先级设置，确保关键数据的传输质量。

路由器识别网络是通过IP数据包中IP地址的网络号进行的，所以为了保证数据包路由的正确性，每个网络都必须有一个唯一的网络号。

> #### 路由表与路由转发
>
> 路由表由路由选择算法得到，主要用于路由选择，总由软件实现。包括四个部分：目的网络$IP$地址、子网掩码、下一跳$IP$地址、接口。
>
> 其中路由表都有一个默认路由：$0.0.0.0$，其子网掩码为$0.0.0.0$，当不知道发送给谁时就发送这个默认路由，让别的路由器帮忙处理。
>
> 转发表由路由表而来，可以使用软件实现也可以使用特殊的硬件实现。转发表必须包含完成转发功能所必须的信息，在每一行都包含要达到的目的网络到输出端口和某些MAC地址信息的映射。
>
> 一般默认网关地址就是路由器的$LAN$端口地址。



## 传输层
### 传输层提供的服务
#### 传输层的功能

1. 传输层提供进程和进程之间的逻辑通信。 
2. 传输层复用和分用发送方和接收方的数据，实现数据的可靠传输。 
3. 传输层对收到的报文进行差错检测，确保数据的准确性。

#### 传输层端口

1. 传输层通过端口号来标识主机中的具体进程。 
2. 端口号是16位的数字，范围从0到65535。 
3. 端口号分为服务端使用的端口号和客户端使用的端口号。
4. 服务端端口号包括熟知端口号（0-1023）和登记端口号（1024-49151）。 
5. 客户端端口号范围从49152到65535，动态分配给客户端进程。

| 协议   | 描述                 | 端口       |
| ------ | -------------------- | ---------- |
| HTTP   | 超文本传输协议       | **80**     |
| HTTPS  | 安全的超文本传输协议 | **443**    |
| FTP    | **文件传输协议**     | **20、21** |
| SSH    | **安全外壳协议**     | **22**     |
| Telnet | **远程登录服务协议** | **23**     |
| SMTP   | **简单邮件发送协议** | **25**     |
| POP3   | **邮局协议3**        | **110**    |
| IMAP   | 互联网邮件访问协议   | 143        |
| NNTP   | 网络新闻传输协议     | 119        |
| DHCP   | 动态主机配置协议     | 67、68     |
| BBS    | 公告牌服务           | 2020       |
| DNS    | 域名解析服务         | 53         |



### UDP协议

UDP提供的是一种**非面向连接的，不可靠**的数据传输，这主要是有些应用需要更快速的数据传输，**局域网内**的大多数文件传输都是基于UDP的。UDP在传输速率上更快，开销更小。

- UDP是一个非连接的协议，传输数据之前源端和终端不建立连接，当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制;在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。
- 由于传输数据不建立连接，因此也就不需要维护连接状态，包括收发状态等，因此一台服务机可同时向多个客户机传输相同的消息。
- **UDP信息包的标题很短，只有8个字节**，相对于TCP的20个字节信息包的额外开销很小。
- **吞吐量不受拥挤控制算法的调节，只受应用软件生成数据的速率、传输带宽、源端和终端主机性能的限制。**
- UDP使用尽最大努力交付，即**不保证可靠交付**，因此主机不需要维持复杂的链接状态表(这里面有许多参数)。
- UDP是面向报文的。发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付给IP层。既不拆分，也不合并，而是保留这些报文的边界，因此，应用程序需要选择合适的报文大小。

> 我们经常使用“ping”命令来测试两台主机之间TCP/IP通信是否正常，**其实“ping”命令的原理就是向对方主机发送UDP数据包**，然后对方主机确认收到数据包，如果数据包是否到达的消息及时反馈回来，那么网络就是通的。

UDP的包头结构:**源端口16位，目的端口16位，长度16位，校验和16位。**

> VolP是指在IP网络上使用IP协议以数据包的方式传输语音，使用UDP协议。



### TCP协议

#### TCP

TCP向下屏蔽IP协议的不可靠传输的特性，向上提供一种**面向连接的、可靠的点到点数据传输**。TCP在可靠性和安全性上等更有保证。

> TCP是面向连接的协议，也就是说，在收发数据前，必须和对方建立可靠的连接。一个TCP连接必须要经**过三次“对话”**才能建立起来，其中的过程非常复杂，只简单的描述下这三次对话的简单过程:主机A向主机B发出连接请求数据包:“我想给你发数据，可以吗?”这是第一次对话;主机B向主机A发送同意连接和要求同步(同步就是两台主机一个在发送，一个在接收，协调工作)的数据包:“可以，你什么时候发?”这是第二次对话;主机A再发出一个数据包确认主机B的要求同步:“我现在就发，你接着吧!”这是第三次对话。三次“对话”的目的是使数据包的发送和接收同步，经过三次“对话”之后，主机A才向主机B正式发送数据。
>
> 
>
> 在TCP/IP协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接。在该协议传输模式中在将数据包成功发送给目标计算机后，TCP会要求发送一个确认;**如果在某个时限内没有收到确认，那么TCP将重新发送数据包**。
>
> 浏览网页使用的是HTTP协议，而HTTP协议是搭载在TCP协议之上的；Telnet协议是TCP/IP协议簇中的一员

#### TCP段

TCP（传输控制协议）报文段是TCP协议在网络中传输数据的基本单位，包含以下主要字段：

| **字段**     | **大小** | **描述**                                 |
| ------------ | -------- | ---------------------------------------- |
| **源端口**   | 16位     | 发送方应用程序的端口号                   |
| **目的端口** | 16位     | 接收方应用程序的端口号                   |
| **序列号**   | 32位     | 用于数据重组，标识数据字节流中的顺序     |
| **确认号**   | 32位     | 下一个期望接收的字节序列号               |
| **数据偏移** | 4位      | TCP头部长度，单位为32位字（4字节）       |
| 保留         | 6位      | 保留位，未使用                           |
| **控制位**   | 6位      | 包含URG、ACK、PSH、RST、SYN、FIN等标志位 |
| 窗口大小     | 16位     | 用于流量控制，指示接收方能够接收的字节数 |
| 校验和       | 16位     | 用于错误检测的校验和                     |
| 紧急指针     | 16位     | 指示紧急数据的结束位置                   |
| 选项         | 可变     | 可选字段，支持不同的TCP功能              |
| 数据         | 可变     | 实际传输的应用层数据                     |

#### TCP可靠传输

TCP的可靠传输通过以下机制实现：

1. **三次握手**：在通信开始前，双方通过三次握手建立连接，确保发送和接收双方的通信能力正常。
2. **序列号与确认机制**：每个报文段都有序列号，接收方通过确认号（ACK）告知发送方已成功接收的数据字节。
3. **超时重传**：若发送方在指定时间内未收到ACK，则会重传数据，确保数据不丢失。
4. **数据校验**：TCP使用校验和检查数据的完整性，确保传输中数据未被损坏。
5. **乱序重排**：如果报文段到达顺序错乱，接收方根据序列号重新排序后提交给应用层。
6. **四次挥手**：在通信结束时，通过四次挥手正常释放连接，避免资源浪费。



## 应用层
### 网络应用模型

#### C/S模型

客户服务器模型将网络上节点分为两类角色：客户和服务器。 服务器提供计算服务，客户请求计算服务。服务器提供永久提供服务、具有永久性访问地址。 客户机特点包括与服务器直接通信、间歇性接入网络、使用动态IP地址、不与其他客户机直接通信。客户服务器模型广泛应用于Web浏览、文件传输、远程登录和电子邮件等应用。

#### P2P模型

P2P是一种**分布式网络**，网络的参与者共享他们所拥有的一部分硬件资源，这些共享资源需要由网络提供服务和内容，能被其它对等节点**直接访问而无需经过中间实体**。在此网络中的参与者既是资源提供者，又是资源获取者。P2P打破了传统的C/S模式，在网络中的每个结点的地位都是对等的。每个结点既充当服务器，为其他结点提供服务，同时也享用其他结点提供的服务。

#### B/S模型

B/S就是“Browser/Server”的缩写。客户端通过**Web浏览器**访问应用，让核心的业务处理在服务端完成。

B/S体系结构**缺乏对动态页面的支持能力**，没有集成有效的数据库处理功能，系统扩展能力差，安全性难以控制，**在数据查询等响应速度上，要远远地低于C/S体系结构**。

B/S体系结构的**数据提交一般以页面为单位，数据的动态交互性不强**，不利于在线事务处理（OLTP）应用



### DNS系统

DNS是域名系统的缩写，该系统用于命名组织到域层次结构中的计算机和网络服务。每一个域名都对应一个唯一的IP地址，在 Internet上域名与IP地址之间是一一对应的，DNS就是进行域名解析的服务器。通过用户友好的名称查找计算机和服务。DNS是因特网的一项核心服务，它作为可以将**域名和IP地址相互映射的一个分布式数据库**。

**只要是通过权威部门授权的服务商都可以绑定解析到他们的DNS上**。

域名解析过程

1. 当主机要访问一个网站时，需要先将域名解析成IP地址，这主要通过DNS服务器实现。 
2. 用户在搜索引擎中输入域名后，DNS服务器进行域名到IP地址的转换，并返回给用户网站的IP地址。 
3. 主机获得IP地址后，可以进行通信并访问网站，网站的信息也可以回复回来。 
4. 如果访问不了网站或显示连接不到服务器，可能是网站崩溃或DNS服务器出现问题。

域名系统由分布在全球各地的域名服务器实现，包括**根域名服务器、顶级域名服务器、权限域名服务器和本地域名服务器**。 

- 根域名服务器：知道所有顶级域名服务器的域名和IP地址。 
- 顶级域名服务器：管理该顶级域名服务器注册的所有二级域名，知道其下各级域名服务器的IP地址。 
- 权限域名服务器：负责一个区的域名服务器，对DNS服务器的管辖范围进行区分。 
- 本地域名服务器：离主机较近，通常不超过几个路由器的距离，负责将主机名转换成IP地址。

域名解析的递归查询和迭代查询

1. 递归查询：主机查询本地域名服务器，本地域名服务器依次查询根域名服务器、顶级域名服务器和权限域名服务器，最终获得IP地址并返回给主机。
2. 迭代查询：本地域名服务器首先查询根域名服务器，根域名服务器告诉本地域名服务器下一步应该查询哪个顶级域名服务器或权限域名服务器，本地域名服务器再依次进行查询，最终获得IP地址并返回给主机。



### FTP

FTP是文件传输协议。FTP协议有两种工作方式：

**PORT(主动)方式**的连接过程是:客户端向服务器的FTP端口(默认是21)发送连接请求，服务器接受连接，建立一条命令链路。当需要传送数据时，**客户端在命令链路上用PORT命令告诉服务器**:“我打开了XXXX端口，你过来连接我”。于是服务器从20端口向客户端的XXXX端口发送连接请求，建立一条数据链路来传送数据。

**PASV(被动)方式**的连接过程是:客户端向服务器的FTP端口(默认是21)发送连接请求，服务器接受连接，建立一条命令链路。当需要传送数据时，**服务器在命令链路上用PASV命令告诉客户端**:“我打开了XXXX端口，你过来连接我”。于是客户端向服务器的XXXX端口发送连接请求，建立一条数据链路来传送数据。

TFTP适用于UDP环境，适用于小文件传输，代码块占内存小。



### 电子邮件

电子邮件系统由三个主要部分组成：用户代理、邮件服务器和协议。 用户代理是用户和电子邮件系统之间的接口，提供撰写、显示、处理和通信功能。 邮件服务器负责发送和接收邮件，并报告邮件的传送结果。 协议用于控制邮件的发送和接收过程，包括SMTP、POP3和IMAP等。

PoP3是适用于**C/S结构的脱机模型**的电子邮件，规定怎样将个人计算机连接到互联网的邮件服务器和下载电子邮件的电子协议，是因特网电子邮件的第一个离线标准。PoP3允许用户把服务器上的邮件存储到本地主机，同时删除先前保存在邮件服务器上的邮件。**电子邮件传输建立的是可靠连接，所以采用TCP连接。**



### WWW

WWW（万维网）是基于互联网的一种信息服务系统，通过超文本和超链接技术，使用户能够访问分布在全球的多种信息资源。万维网由**URL**（统一资源定位符）链接各种资源，用户可以通过浏览器访问网站上的内容。

**URL的基本结构**：协议://域名或IP地址:端口号/路径?查询参数#片段标识符



### 常见协议

#### BGP

**BGP 是一种外部网关协议（EGP），主要用于不同自治系统（AS）之间的路由选择。是互联网的核心路由协议。**广泛应用于互联网运营商和大型网络中，用于交换路由信息。

BGP是最复杂的路由协议，属于**应用层协议**，其传输层使用TCP，默认端口号是179。 **BGP是唯一使用TCP作为传输层的路由协议**。



#### HTTP

HTTP是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准(TCP)，用于从WWW服务器传输超文本到本地浏览器的传输协议。HTTP是采用明文形式进行数据传输，极易被不法份子窃取和篡改。**HTTP是应用层的通信协议**。



#### HTTPS

HTTPS可以理解为是安全版的HTTP协议，实际就是在 TCP 层与 HTTP 层之间加入**SSL/TLS**的安全认证机制 ，实现客户端与服务器的数据加密传输，最终达到保证整个通信的安全性的目的，主要用到**对称加密、非对称加密、证书**等技术。

- HTTP 是不安全的明文传输，而 HTTPS 是安全的加密传输协议(对数据进行加密，并建立一个信息安全通道，来保证传输过程中的数据安全);
- HTTP 标准端口是80，而 HTTPS 的标准端口是443;
- 在OSI网络模型中，**HTTP工作于应用层，而HTTPS 的安全传输机制工作在传输层**。
- HTTP无需证书，而HTTPS 需要CA机构颁发的SSL证书。
- HTTPS对网站服务器进行**真实身份认证**。
- HTTPS比HTTP更加安全，对**搜索引擎更友好，利于SEO**。
- HTTPS在浏览器显示绿色安全锁，HTTP没有显示。

**HTTPS协议同样位于OSI模型的应用层**，但它在HTTP的基础上添加了一个安全层，通常是TLS（传输层安全协议）。因此，**尽管HTTPS在应用层进行数据传输，但它通过TLS加密来提供安全性，涉及到传输层的功能。**



### 应用层设备

#### 网关

网关(Gateway)又称网间连接器、协议转换器。网关在网络层以上实现网络互连，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连。网关既可以用于广域网互连，也可以用于局域网互连。网关是一种充当转换重任的计算机系统或设备。**使用在不同的通信协议、数据格式或语言，甚至体系结构完全不同的两种系统之间，网关是一个翻译器，与网桥只是简单地传达信息不同，网关对收到的信息要重新打包，以适应目的系统的需求**。**网关处在应用层**。



## 网络管理

根据国际标准化组织定义网络管理有五大功能：**故障管理、配置管理、性能管理、安全管理、计费管理**。

网络故障管理包括**故障检测、隔离和纠正**三方面，应包括以下典型功能：维护并检查错误日志。接受错误检测报告并作出响应。跟踪、辨认错误。执行诊断测试。纠正错误。

计费管理记录网络资源的使用，目的是控制和监测网络操作的费用和代价。

配置管理同样相当重要。它初始化网络、并配置网络，以使其提供网络服务，目的是为了实现某个特定功能或使网络性能达到最优。

性能管理估价系统资源的运行状况及通信效率等系统性能。

安全性一直是网络的薄弱环节之一，而用户对网络安全的要求又相当高，因此网络安全管理非常重要。

> 网络入侵检测系统的主要实现手段是监视和分析网络流量以及异常行为，包括但不限于对网络协议的监视、对数据包结构的分析以及对网络行为的监控。通过实时监测和分析网络流量，IDS能够发现异常行为模式并发出警报，以便管理员采取适当的措施。

### 常用网络命令

|  | 命令 | 作用描述 |
| ---- | -------- | -------- |
| telnet | `telnet [hostname] [port]` | **与远程主机建立 TCP 连接，常用于测试网络服务的连通性。** |
| ping | `ping [hostname/IP]` | **测试主机与目标 IP 地址的连通性**，发送 ICMP 回显请求。 |
| ipconfig | `ipconfig`（显示所有配置<br/>`ipconfig /all`（显示详细配置） | 显示**IP 地址、子网掩码和网关。** |
| arp | `arp -a`（显示当前 ARP 缓存） | **显示 ARP 缓存，查看 IP 地址与 MAC 地址的映射关系**。 |
| traceroute | `traceroute [hostname/IP]` | **跟踪数据包到达目标主机的路径，显示经过的路由器的信息。** |
| route | `route print`（查看路由表）<br />`route add`（添加路由） | **查看和修改路由表，管理网络数据包的转发。** |
| nslookup | `nslookup [hostname]` | **查询 DNS 记录，获取域名与 IP 地址之间的映射。** |
| nbtstat | `nbtstat -n`（显示 NetBIOS 名称） | 显示TCP/IP 统计信息，常用于 Windows 网络。 |
| netstat | `netstat -a`（显示所有连接），`netstat -r`（显示路由表） | **显示网络连接、路由表和网络接口的状态，监控网络活动。** |
| net | `net [command]` | 管理网络共享、用户和网络服务等，提供多种网络管理功能。 |



## 推荐视频

:star: :star: :star: 【从零理解计算机网络】 https://www.bilibili.com/video/BV1ozBeYZEYa/?share_source=copy_web

<video src="../资源/计算机网络（中英）基础讲解.mp4"></video>

---

:star: :star: :star: 【10分钟速通计算机网络 每个开发者都具备的计算机常识】 https://www.bilibili.com/video/BV1jx421X7zH/?share_source=copy_web&vd_source=480aa1ab6f679a8e2419597450b2f8b8

<video src="../资源/计算机网络基础讲解.mp4"></video>

---

:star: :star: :star: 【王道计算机考研 计算机网络】 https://www.bilibili.com/video/BV19E411D78Q/?share_source=copy_web&vd_source=480aa1ab6f679a8e2419597450b2f8b8

**认准咸鱼学长**
